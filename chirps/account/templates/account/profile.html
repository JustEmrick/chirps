{% extends "base.html" %}
{% load static %}
{% block content %}

<h1 class="text-success">Account Settings</h1>
<hr>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{message.tags}}" role="alert">
            {{message}}
        </div>
    {% endfor %}
{% endif %}

<div class="card my-4">
    <div class="card-body cardbody-color p-4">
        <h5 class="card-title">API Keys</h5>
        <div class="form-group">
            <form method="POST" action="{% url 'profile'%}">
                {% csrf_token %}

                <div class="row">

        <!-- Finding Preview Size -->
        <div class="form-group">
            <label for="{{ form.finding_preview_size.id_for_label }}">Finding Preview Size:</label>
            {{ form.finding_preview_size }}
            <small class="form-text text-muted">Configure the size of the Scan finding preview window</small>
        </div>

        <div class="mt-3 d-flex">
            <button class="btn btn-success ml-auto mr-0" type="submit">Save</button>
                    <!-- OpenAI Key -->
                    <div class="form-group col">
                        <label for="{{ form.openai_key.id_for_label }}">
                            <img src="{% static 'account/openai_logo.png' %}" alt="OpenAI Logo" class="img-fluid" style="height: 1.5rem;">
                        </label>

                        <div class="input-group mb-3" id="openai_group">
                            <input type="text" class="form-control"
                                   id="{{ form.openai_key.auto_id }}"
                                   name="{{ form.openai_key.html_name }}"
                                   value="{{ user.profile.masked_openai_key }}"
                                   placeholder="Enter OpenAI key or leave it blank">
                            <div class="input-group-append" hx-get="{% url 'get_openai_key' %}" hx-target="#openai_group">
                              <span class="input-group-text api-key-icon">
                                <i class="fa fa-eye" aria-hidden="true"></i>
                                <i class="fa fa-eye-slash" aria-hidden="true"></i>
                              </span>
                            </div>
                        </div>
                    </div>

                    <!-- Cohere Key -->
                    <div class="form-group col">
                        <label for="{{ form.cohere_key.id_for_label }}">
                            <img src="{% static 'account/cohere_logo.png' %}" alt="Cohere Logo" class="img-fluid" style="height: 1.5rem;">
                        </label>

                        <div class="input-group mb-3" id="cohere_group">
                            <input type="text" class="form-control"
                                   id="{{ form.cohere_key.auto_id }}"
                                   name="{{ form.cohere_key.html_name }}"
                                   value="{{ user.profile.masked_cohere_key }}"
                                   placeholder="Enter Cohere key or leave it blank">
                            <div class="input-group-append" hx-get="{% url 'get_cohere_key' %}" hx-target="#cohere_group">
                              <span class="input-group-text"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-3 d-flex">
                    <button class="btn btn-success ml-auto mr-0" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Toast notification -->
<div aria-live="polite" aria-atomic="true" style="position: fixed; top: 10px; right: 10px; z-index: 0;">
    <div class="toast bg-success" id="toast-notification" style="position: fixed; top: 10px; right: 10px;" data-bs-autohide="true" data-bs-delay="5000">
        <div class="toast-header">
            <strong class="me-auto">Success!</strong>
            <button type="button" class="btn" data-bs-dismiss="toast" aria-label="Close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <div class="toast-body">
            API Key coiped to clipboard.
        </div>
    </div>
</div>
<!-- End of Toast notification -->

<script>
    function CopyToClipboard(elementId) {

        let elementToCopy = document.getElementById(elementId);
        elementToCopy.select();

        /* Copy the text inside the text field */
        document.execCommand("copy");

        const toastElement = document.getElementById("toast-notification");
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
    }

    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    })
</script>

<style>
.api-key-icon:hover .fa-eye-slash,
.api-key-icon .fa-eye {
    display: none;
}

.api-key-icon:hover .fa-eye {
    display: inline;
}
</style>
{% endblock %}
